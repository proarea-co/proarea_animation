
stages:
  - Analyze
  - Test
  - Build

.job_setting_head:
  image: cirrusci/flutter:latest
  tags:
    - proarea-animations
  before_script:
    - flutter clean
    - flutter pub get

.job_setting_to_dev:
  extends: .job_setting_head
  rules:
    - if: '$CI_PIPELINE_SOURCE == "merge_request_event"'
    - if: '$CI_COMMIT_BRANCH == "dev"'

.job_setting_to_no_dev:
  extends: .job_setting_head
  rules:
    - if: '$CI_PIPELINE_SOURCE == "merge_request_event"'
  when: always

Flutter analyze:
  extends: .job_setting_to_no_dev
  stage: Analyze
  script:
    - flutter analyze

Unit tests:
  extends: .job_setting_to_dev
  stage: Test
  script:
    - echo 'Unit tests - Successfully'

Widget tests:
  extends: .job_setting_to_dev
  stage: Test
  script:
    - echo 'Widget tests - Successfully'

Integration tests:
  extends: .job_setting_to_dev
  stage: Test
  script:
    - echo 'Integration tests - Successfully'

Build Android apk:
  extends: .job_setting_to_dev
  stage: Build
  script:
    - flutter build apk
  artifacts:
    paths:
      - "build/app/outputs/apk/release/pro_an_*.apk"
    expire_in: 1 day

Build iOS ipa:
  extends: .job_setting_to_dev
  stage: Build
  script:
    - echo 'iOS ipa - Successfully build'
